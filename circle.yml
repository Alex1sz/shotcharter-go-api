machine:
  environment:
    GOPATH: "$HOME/.go_project"
    PROJECT_PARENT_PATH: "$GOPATH/src/github.com/$CIRCLE_PROJECT_USERNAME"
    PROJECT_PATH: "$PROJECT_PARENT_PATH/$CIRCLE_PROJECT_REPONAME"
    CONFIGOR_ENV: production
    DB_CONNECTION: postgres://postgres@127.0.0.1:5432/shotcharter_go_test?sslmode=disable
  services:
    - postgresql
database:
  override:
    - createdb shotcharter_go_test
    - psql shotcharter_go_test -f db/schema_setup.sql
dependencies:
  pre:
    - go get -d -v
  override:
    - sudo add-apt-repository ppa:masterminds/glide -y && sudo apt-get update
    - sudo apt-get install glide -y
    - mkdir -p "$PROJECT_PARENT_PATH"
    - ln -sf "$HOME/$CIRCLE_PROJECT_REPONAME/" "$PROJECT_PATH"
test:
  pre:
    - cd "$PROJECT_PATH" && glide install
    - echo $GOPATH
    - echo $PROJECT_PARENT_PATH
    - echo $PROJECT_PATH
    - go build -v
  override:
    - cd "$PROJECT_PATH" && go test $(glide novendor)
